# üìò Glossary Load test

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ —Å–ª–æ–≤–∞—Ä—è, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–≤—É—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ ‚Äî REST –∏ gRPC. –¶–µ–ª—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ ‚Äî —Å—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π, –∞ —Ç–∞–∫–∂–µ –≤—ã—è–≤–∏—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è—Ö –Ω–∞–≥—Ä—É–∑–∫–∏.

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

- AMD Ryzen 7600 CPU
- 32GB DDR5 5000MHz
- –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å
- locust 2.43.0

## üß™ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞

–¢–µ—Å—Ç–æ–≤—ã–π —Å—Ç–µ–Ω–¥ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é Docker Compose –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å–ª–æ–≤–∞—Ä—è: REST –∏ gRPC, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 8000, –∏ 50051 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ SQLite –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥–∫–ª—é—á–∞–µ–º–æ–π –∫–∞–∫ volume. Locust –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ —Ö–æ—Å—Ç–µ.

–ó–∞–ø—É—Å–∫ —Å –ø–æ–º–æ—â—å—é Docker Compose

```
docker-compose up -d
```

## üîÅ –õ–æ–≥–∏–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–í –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–º —Ç–µ—Å—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–∞ —Ç–∏–ø–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤: REST-–∫–ª–∏–µ–Ω—Ç –∏ gRPC-–∫–ª–∏–µ–Ω—Ç, –º–æ–¥–µ–ª–∏—Ä—É—é—â–∏–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –±–∏–∑–Ω–µ—Å-–ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–æ —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã. –û–±–∞ —Ç–∏–ø–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤:

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Å–ª—É—á–∞–π–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0‚Äì10000 –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Ç–µ—Ä–º–∏–Ω–æ–≤.
- –°—á–∏—Ç–∞—é—Ç –æ—Ç–≤–µ—Ç HTTP 404 (Not Found) –¥–æ–ø—É—Å—Ç–∏–º—ã–º –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏, –∏–∑–º–µ–Ω—è—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–º —á—Ç–µ–Ω–∏–∏ (GetTerm/GetAllTerms) –≤–æ–∑–º–æ–∂–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —Ä–∞—Å—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ—à–∏–±–∫–∞ —Å–∏—Å—Ç–µ–º—ã.
- –î–µ–ª–∞—é—Ç –ø–∞—É–∑—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 1‚Äì3 —Å–µ–∫—É–Ω–¥—ã.

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π

–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (80% —á—Ç–µ–Ω–∏–µ / 20% –∑–∞–ø–∏—Å—å) –≤—ã–±—Ä–∞–Ω–æ –∏—Å—Ö–æ–¥—è –∏–∑ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî —Å–ª–æ–≤–∞—Ä—è —Ç–µ—Ä–º–∏–Ω–æ–≤, –≥–¥–µ –æ—Å–Ω–æ–≤–Ω–∞—è –º–∞—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ä–µ–∂–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏).

- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ (40%)
- –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞ –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É (40%)
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞ (5%)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞ (5%)
- –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞ (5%)

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–º–∏ —Ç–µ—Ä–º–∏–Ω–∞–º–∏ —Å –ø–æ–º–æ—â—å—é seed-—Å–∫—Ä–∏–ø—Ç–∞. –û–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –≤—Ä—É—á–Ω—É—é —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–º–∞–Ω–¥–æ–π:

```
python scripts/seed_db.py --db <path_to_db> [--count <num_terms>]
```

| –ê—Ä–≥—É–º–µ–Ω—Ç  | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ                                      | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| --------- | -------------- | --------------------------------------------- | --------------------- |
| `--db`    | –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ    | –ü—É—Ç—å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É SQLite —Ñ–∞–π–ª—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | ‚Äî                     |
| `--count` | –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Ä–º–∏–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å   | `10000`               |

–ó–∞–ø—É—Å–∫ Locust:

```
locust -f load-tests/locustfile.py --class-picker
```

## üö¶ –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –õ—ë–≥–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (Sanity check)

| –ü–∞—Ä–∞–º–µ—Ç—Ä     | –ó–Ω–∞—á–µ–Ω–∏–µ |
| ------------ | -------- |
| Users        | 50       |
| Spawn rate   | 5        |
| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 5 –º–∏–Ω    |

[–û—Ç—á–µ—Ç Locust](/reports/Locust_sanity_check.html)

| –ú–µ—Ç—Ä–∏–∫–∞  | REST        | gRPC      |
| -------- | ----------- | --------- |
| RPS      | ~2.4        | ~6.0      |
| Average  | 2.6‚Äì14.7 ms | 0‚Äì2.8 ms  |
| p95      | 3‚Äì123 ms    | 0‚Äì12 ms   |
| p99      | 12‚Äì19184 ms | 2‚Äì3018 ms |
| –ú–∏–Ω–∏–º—É–º  | 3 ms        | 0 ms      |
| –ú–∞–∫—Å–∏–º—É–º | 35545 ms    | 3018 ms   |
| –û—à–∏–±–∫–∏   | 112 (6.7%)  | 873 (40%) |
| Requests | 731         | 2108      |

gRPC –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ —Å—Ä–µ–¥–Ω–µ–º—É –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞ (0-2.8ms vs 2.6-14.7ms —É REST) –∏ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π RPS, 6.0 –ø—Ä–æ—Ç–∏–≤ 2.4, –Ω–æ —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –æ—à–∏–±–æ–∫ (40% –ø—Ä–æ—Ç–∏–≤ 6.7%). –¢–µ—Å—Ç –≤—ã—è–≤–∏–ª —Å–∏—Å—Ç–µ–º–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: REST-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500 –æ—à–∏–±–∫–∏ –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ SQLite, —Ç–æ–≥–¥–∞ –∫–∞–∫ gRPC-–∫–ª–∏–µ–Ω—Ç –º–∞—Å—Å–æ–≤–æ —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è —Å –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ–º —Ç–∞–π–º–∞—É—Ç–æ–≤ (DEADLINE_EXCEEDED). –û–±–∞ —Ñ–∞–∫—Ç–∞ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å SQLite —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.

### –†–∞–±–æ—á–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (Normal / Baseline load)

| –ü–∞—Ä–∞–º–µ—Ç—Ä     | –ó–Ω–∞—á–µ–Ω–∏–µ |
| ------------ | -------- |
| Users        | 100      |
| Spawn rate   | 10       |
| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 10 –º–∏–Ω   |

[–û—Ç—á–µ—Ç Locust](/reports/Locust_baseline_load.html)

| –ú–µ—Ç—Ä–∏–∫–∞  | REST         | gRPC       |
| -------- | ------------ | ---------- |
| RPS      | ~1.1         | ~13.3      |
| Median   | 20‚Äì38k ms    | 0‚Äì3k ms    |
| p95      | 33‚Äì54k ms    | 0‚Äì3k ms    |
| p99      | 39‚Äì60k ms    | 2‚Äì3k ms    |
| Average  | 18.3‚Äì34.1 ms | 0‚Äì3.0 ms   |
| –ú–∏–Ω–∏–º—É–º  | 5 ms         | 0 ms       |
| –ú–∞–∫—Å–∏–º—É–º | 67626 ms     | 3019 ms    |
| –û—à–∏–±–∫–∏   | 252 (32%)    | 4916 (81%) |
| Requests | 1058         | 8134       |

REST –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞–ª (p95/p99 33-60k ms –∏–∑-–∑–∞ SQLite –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫), gRPC –¥–µ—Ä–∂–∏—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ 3k ms –Ω–æ —Å 81% –æ—à–∏–±–æ–∫. REST —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –±–∞–∑—ã, –∞ gRPC ¬´–æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è¬ª –æ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑-–∑–∞ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è deadline –≤ 3 —Å–µ–∫—É–Ω–¥—ã, –æ–¥–Ω–∞–∫–æ —ç—Ç–æ —è–≤–ª—è–µ—Ç—Å—è —Å–ª–µ–¥—Å—Ç–≤–∏–µ–º —É–ø–æ—Ä–∞ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–∑–≤–æ–ª–∏—Ç —Å–Ω–∏–∑–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–∫–∏—Ö –æ—à–∏–±–æ–∫, –Ω–æ –Ω–µ —É—Å—Ç—Ä–∞–Ω–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ SQLite.

### –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç (Peak / Stress load)

| –ü–∞—Ä–∞–º–µ—Ç—Ä     | –ó–Ω–∞—á–µ–Ω–∏–µ |
| ------------ | -------- |
| Users        | 500      |
| Spawn rate   | 100      |
| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 5 –º–∏–Ω    |

[–û—Ç—á–µ—Ç Locust](/reports/Locust_stress_load.html)

| –ú–µ—Ç—Ä–∏–∫–∞  | REST        | gRPC       |
| -------- | ----------- | ---------- |
| RPS      | ~0.8        | ~94        |
| Median   | 147‚Äì153k ms | 0‚Äì88 ms    |
| p95      | 179‚Äì214k ms | 1‚Äì3k ms    |
| p99      | 180‚Äì214k ms | 2‚Äì4.3k ms  |
| Average  | 119‚Äì133k ms | 0.3‚Äì563 ms |
| –ú–∏–Ω–∏–º—É–º  | 132 ms      | 0 ms       |
| –ú–∞–∫—Å–∏–º—É–º | 213693 ms   | 5625 ms    |
| –û—à–∏–±–∫–∏   | 336 (65%)   | 2534 (14%) |
| Requests | 389         | 31315      |

gRPC –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (94 RPS vs 0.8 —É REST). REST –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–µ–Ω (65% –æ—à–∏–±–æ–∫, –∑–∞–¥–µ—Ä–∂–∫–∏ 2-3 –º–∏–Ω—É—Ç—ã). –ë—ã–ª–æ –≤—ã—è–≤–ª–µ–Ω–æ, —á—Ç–æ –ø—Ä–∏ —É–º–µ—Ä–µ–Ω–Ω–æ–π, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º–∞ –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç —Å–∏–ª—å–Ω–µ–µ, —á–µ–º –ø—Ä–∏ –∫–æ—Ä–æ—Ç–∫–æ–º –ø–∏–∫–æ–≤–æ–º —Å—Ç—Ä–µ—Å—Å–µ. –ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–ø–∞–≤–Ω), –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –∫–∞–∂–¥–∞—è –Ω–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π, —É–≤–µ–ª–∏—á–∏–≤–∞—è –æ—á–µ—Ä–µ–¥—å –∏ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞.

### –¢–µ—Å—Ç –Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (Soak / Stability test)

| –ü–∞—Ä–∞–º–µ—Ç—Ä     | –ó–Ω–∞—á–µ–Ω–∏–µ |
| ------------ | -------- |
| Users        | 20       |
| Spawn rate   | 2        |
| –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 20 –º–∏–Ω   |

[–û—Ç—á–µ—Ç Locust](/reports/Locust_stability_test.html)

| –ú–µ—Ç—Ä–∏–∫–∞  | REST       | gRPC      |
| -------- | ---------- | --------- |
| RPS      | ~4.5       | ~5.5      |
| Median   | 5‚Äì57 ms    | 0‚Äì13 ms   |
| p95      | 98‚Äì320 ms  | 0‚Äì68 ms   |
| p99      | 130‚Äì450 ms | 2‚Äì130 ms  |
| Average  | 19‚Äì185 ms  | 0.1‚Äì22 ms |
| –ú–∏–Ω–∏–º—É–º  | 3 ms       | 0 ms      |
| –ú–∞–∫—Å–∏–º—É–º | 639 ms     | 242 ms    |
| –û—à–∏–±–∫–∏   | 16 (0.5%)  | 14 (0.4%) |
| Requests | 5693       | 5957      |

–û–±–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç –æ—Ç–ª–∏—á–Ω—É—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏ (<0.5%) –∏ –ø—Ä–∏–µ–º–ª–µ–º—ã–º–∏ –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—è–º–∏ (p95 –¥–æ 320ms REST, 68ms gRPC). gRPC –æ—Å—Ç–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ –ø–æ –≤—Å–µ–º –º–µ—Ç—Ä–∏–∫–∞–º (–≤ 3-10 —Ä–∞–∑), –Ω–æ REST —Ç–æ–∂–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É–º–µ—Ä–µ–Ω–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ. –ü—Ä–∏ RPS ~10, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–¥–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–æ–±–ª–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–µ –≤—ã—è–≤–ª–µ–Ω–∞.

## üß† –í—ã–≤–æ–¥—ã

–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ gRPC –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å REST: –±–æ–ª—å—à–∏–π RPS –∏ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –º–µ–Ω—å—à—É—é –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å. –û–±–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É—Å—Ç–æ–π—á–∏–≤–æ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ –¥–æ ~10 RPS, –æ–¥–Ω–∞–∫–æ –ø—Ä–∏ –¥–∞–ª—å–Ω–µ–π—à–µ–º —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º–∞ —É–ø–∏—Ä–∞–µ—Ç—Å—è –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite.

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π livelock –≤ SQLite: –ø—Ä–∏ —É–º–µ—Ä–µ–Ω–Ω–æ–π, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –≤—ã—Ä–∞–∂–µ–Ω–∞ —Å–∏–ª—å–Ω–µ–µ, —á–µ–º –ø—Ä–∏ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –ø–∏–∫–æ–≤–æ–º —Å—Ç—Ä–µ—Å—Å–µ. –í —Ç–µ–∫—É—â–µ–º –≤–∏–¥–µ –æ–±–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ production-—Å—Ä–µ–¥–µ.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- –û—Å–Ω–æ–≤–Ω—ã–º —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º —Å–∏—Å—Ç–µ–º—ã —è–≤–ª—è–µ—Ç—Å—è SQLite, –±–ª–æ–∫–∏—Ä—É—é—â–∞—è—Å—è –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –∏ –ø—Ä–∏–≤–æ–¥—è—â–∞—è –∫ –æ—à–∏–±–∫–µ sqlite3.OperationalError: database is locked. SQLite –Ω–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é –∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω–∞.
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ gRPC deadline –º–æ–∂–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ DEADLINE_EXCEEDED –∏ –ø–æ–≤—ã—Å–∏—Ç—å –Ω–∞–±–ª—é–¥–∞–µ–º—ã–π RPS, –æ–¥–Ω–∞–∫–æ —ç—Ç–æ –Ω–µ —Ä–µ—à–∞–µ—Ç –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É ‚Äî –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≤—ã–∑—ã–≤–∞—é—â–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å.

### –£–ª—É—á—à–µ–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞:

- –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ PostgreSQL —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π WAL –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, read replicas –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ –ø–æ–≤—ã—à–µ–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞.
- –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è (GetAllTerms, GetTerm), –∫–æ—Ç–æ—Ä—ã–µ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç 80‚Äì90% –≤—Å–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞.
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ Docker Compose —Å–µ—Ä–≤–∏—Å–∞ —Å Locust –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø–æ—Ä—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å—Ç–µ–Ω–¥–∞ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ö–æ—Å—Ç–∞, –∞ —Ç–∞–∫–∂–µ —Ñ–∏–∫—Å–∞—Ü–∏–∏ –≤–µ—Ä—Å–∏–∏ Locust.

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

- –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è gRPCUser –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞, —á—Ç–æ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å —Å–µ—Ç–µ–≤–æ–π overhead –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å Protobuf-—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å JSON –≤ REST.
- –õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏. –ü—Ä–∏ —ç—Ç–æ–º –∏–º–µ–Ω–Ω–æ SQLite –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º —Å–∏—Å—Ç–µ–º—ã, –∑–∞–Ω–∏–∂–∞—é—â–∏–º –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è gRPC.
